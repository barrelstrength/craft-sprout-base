{% extends "sprout/_layouts/base" %}
{% import "_includes/forms" as forms %}
{% import "sprout/_includes/sproutcp" as sproutCp %}

{% do view.registerAssetBundle("barrelstrength\\sproutbase\\web\\assetbundles\\sproutcp\\SproutCpAsset") %}
{% do view.registerAssetBundle("barrelstrength\\sproutbase\\web\\assetbundles\\redirects\\RedirectsAsset") %}

{% set title = (redirect.id != "" ? "Edit Redirect"|t('sprout') : "Create a new redirect"|t('sprout')) %}

{% set crumbs = [
    { label: "Redirects"|t('sprout'), url: cpUrl('sprout/redirects/' ~ currentSite.handle) }
] %}

{% set fullPageForm = true %}
{% set saveShortcutRedirect = continueEditingUrl %}

{% set selectedItem = currentSite %}

{% block actionButton %}
    <div class="buttons">
        <div class="btngroup submit first">
            <input type="submit" class="btn submit" value="{{ 'Save'|t('sprout') }}">
            <div class="btn submit menubtn"></div>
            <div class="menu">
                <ul>
                    <li><a class="formsubmit"
                            data-redirect="{{ continueEditingUrl|hash }}">{{ "Save and continue editing"|t('sprout') }}
                            <span class="shortcut">âŒ˜S</span></a></li>
                    <li><a class="formsubmit"
                            data-redirect="{{ saveAsNewUrl|hash }}">{{ "Save and add another"|t('sprout') }}</a>
                    </li>
                    {% if redirect.id is not null %}
                        <hr>
                        <ul>
                            <li>
                                {% set redirectAfterDelete = cpUrl('sprout/redirects/' ~ currentSite.handle) %}
                                <a class="formsubmit error" data-action="sprout/redirects/delete-redirect" data-confirm="{{ 'Are you sure you want to delete this redirect?'|t('sprout') }}" data-redirect="{{ redirectAfterDelete|hash }}">{{ "Delete"|t('sprout') }}</a>
                            </li>
                        </ul>
                    {% endif %}
                </ul>
            </div>
        </div>
        {% if config.getEnableUpgradeMessages() and config.isUpgradable() %}
            {{ sproutCp.upgradeToProButton({
                url: config.getUpgradeUrl(),
                title: config.getUpgradeMessage()
            }) }}
        {% endif %}
    </div>
{% endblock %}

{% block content %}

    <input type="hidden" name="action" value="sprout/redirects/save-redirect">
    <input type="hidden" name="redirectId" value="{{ redirect.id }}">
    {% set redirectUrl = 'sprout/redirects' %}
    <input type="hidden" name="redirect" value="{{ redirectUrl|hash }}">

    {% if redirect.id %}
        <input type="hidden" name="redirectId" value="{{ redirect.id }}">
    {% endif %}

    <input type="hidden" name="siteId" value="{{ currentSite.id }}">

    {% include "sprout/redirects/redirects/_fields" %}

{% endblock %}

{% block details %}

    <div class="meta">
        {{ forms.lightswitchField({
            label: "Enabled"|t('sprout'),
            name: 'enabled',
            on: redirect.enabled,
            id: 'enabled',
            first: true
        }) }}
    </div>

    <hr>

    <div class="meta read-only">
        <div class="data">
            <div class="heading">{{ "Site"|t('sprout') }}</div>
            <div class="value">{{ redirect.getSite().name }}</div>
        </div>
        <div class="data">
            <div class="heading">{{ "Base URL"|t('sprout') }}</div>
            <div class="value">
                <input type="text" value="{{ redirect.getSite().baseUrl }}" class="text fullwidth" style="padding-left:0;border:none;box-shadow:none;"/>
            </div>
        </div>
        {% if redirect.id %}
            <div class="data">
                <div class="heading">{{ "Count <span class='info'>The total number of times a redirect has been used.</span>"|t('sprout')|raw }}</div>
                <div class="value">{{ redirect.count }}</div>
            </div>
        {% endif %}
    </div>

    <div class="meta read-only">

        <h2>{{ "Regular Expressions"|t('sprout') }}</h2>

        <p>{{ "Redirect multiple URLs with a similar pattern with the 'Regular Expression' Match Strategy."|t('sprout') }}</p>

        <p>
            <strong>{{ "Old URL - Regular Expressions"|t('sprout') }}</strong>
        </p>
        <ul>
            <li>{{ "old-location/(.*)"|t('sprout') }}</li>
            <li>{{ "old-location/(\\d{4})/(\\d{2})"|t('sprout') }}</li>
        </ul>

        <p>
            <strong>{{ "New URL - Capture Groups"|t('sprout') }}</strong>
        </p>
        <ul>
            <li><em>{{ "new-location/$1"|t('sprout') }}</em></li>
            <li><em>{{ "new-location/$1/$2"|t('sprout') }}</em>
            </li>
        </ul>

    </div>
{% endblock %}
