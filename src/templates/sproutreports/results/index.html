{% extends "_layouts/cp" %}

{% set title  = 'sproutreports'|t %}

{% set selectedSubnavItem = craft.app.request.segment(2) %}
{% if dataSource is defined %}
	{% set optionsHtml = dataSource.getOptionsHtml() %}
{% endif %}

{% set extraPageHeaderHtml %}
		<a id="modify-options-icon" class="btn" data-icon="settings"></a>
{% endset %}

{% set crumbs = [
{ label: "Reports"|t('sproutcore'), url: dataSource.getUrl() },
{ label: "Edit "|t('sproutcore') ~ report.name, url: report.getEditUrl() }
] %}

{% block content %}

	{% if optionsHtml %}

		<div id="modify-options-panel">

			<form id="report-options" method="post" accept-charset="UTF-8">
				{{ getCsrfInput() }}
				<input type="hidden" name="action" value="sprout-core/reports/update-report">
				{{ redirectInput(redirectUrl) }}
				<input type="hidden" name="reportId" value="{{ reportId }}">
				{{ optionsHtml | raw }}

				<div class="button">
					<div class="btngroup">
						<input type="submit" class="btn submit" value="{{ 'Submit Report'|t('sproutcore') }}">
					</div>
				</div>

			</form>

			<hr>

		</div>

	{% endif %}

	<div class="tableview sproutreports">
		{% if values is defined and values is iterable and values|length %}
			<div class="tablecontent">
				<table class="data fullwidth">
					<thead>
						<tr>
							{% for label in labels %}
								<th>
									<div {% if loop.index == "1" %}class="first"{% endif %}><h3>{{ label }}</h3></div>
								</th>
							{% endfor %}
						</tr>
					</thead>
					<tbody>
						{% for value in values %}
							<tr class="table_row">
								{% for property in value %}
									<td>
										<div class="item_content">
											{% if report.allowHtml %}
												{{ property|raw }}
											{% else %}
												{{ property }}
											{% endif %}
										</div>
									</td>
								{% endfor %}
							</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
		{% else %}
			<p>{{ "This report currently has no results."|t('sproutcore') }}</p>
		{% endif %}
	</div>

{% endblock %}

{% includejs %}

	(function(){

		$('#modify-options-icon').on('click', function() {
			$('#modify-options-panel').slideToggle('slow');
		});

	})();

{% endincludejs %}