{% requireAdmin %}

{% import "_includes/forms" as forms %}
{% import "sprout/fields/_includes/forms" as sproutFields %}

{% macro configWarning(setting) -%}
    {{ "This is being overridden by the {setting} config setting."|t('sprout-forms-google-recaptcha', {
        setting: setting
    })|raw }}
{%- endmacro %}

{% from _self import configWarning %}

{% set templateOptions = sprout.app.formTemplates.getFormTemplateOptions() %}

{{ forms.field({
    label: "Default Form Templates"|t('sprout'),
    required: true,
    errors: (settings is defined ? settings.getErrors('formTemplateId') : null),
    instructions: "The default templates that will be used to output your forms when using the displayForm tag if no Form Templates are selected for a given form. Add additional form templates via the Form Templates API or providing a custom template path."|t('sprout'),
    warning: config.formTemplateId is defined ? configWarning('formTemplateId')
}, sproutFields.selectOther({
    name: 'formTemplateId',
    options: templateOptions,
    value: settings.formTemplateId ?? null,
    otherPlaceholderText: '_forms/mycustomtemplates'|t('sprout')
})) }}

<hr>

{{ forms.lightswitchField({
    label: "Save data to the Craft database"|t('sprout'),
    instructions: "Disable this setting to stop Sprout Forms from saving all form submission data to the Craft database and hide the Form Entries tab. Existing data will not be deleted, but will no longer be accessible via the Control Panel."|t('sprout'),
    id: 'enableSaveData',
    name: 'enableSaveData',
    toggle: 'settings-savedatadetails',
    on: settings.enableSaveData,
    onLabel: "Enable"|t('sprout'),
    warning: config.enableSaveData is defined ? configWarning('enableSaveData')
}) }}

<div id="settings-savedatadetails"
    class="{{ not settings.enableSaveData ? "hidden" : '' }}">

    {{ forms.lightswitchField({
        label: "Save Spam to the database",
        instructions: "How form entries will behave after a submission is flagged as spam. See Spam Protection settings for additional control.",
        name: 'saveSpamToDatabase',
        on: settings.saveSpamToDatabase,
        onLabel: "Enable"|t('sprout'),
        warning: config.saveSpamToDatabase is defined ? configWarning('saveSpamToDatabase')
    }) }}

    {{ forms.lightswitchField({
        label: "Default behavior for saving data"|t('sprout'),
        instructions: "The default behavior for saving data when a new Form is created."|t('sprout'),
        id: 'enableSaveDataDefaultValue',
        name: 'enableSaveDataDefaultValue',
        on: settings.enableSaveDataDefaultValue,
        onLabel: "Enable"|t('sprout'),
        warning: config.enableSaveDataDefaultValue is defined ? configWarning('enableSaveDataDefaultValue')
    }) }}

    {{ forms.lightswitchField({
        label: "Track Remote IP"|t('sprout'),
        instructions: "Enable to capture the IP Address used when a Form Entry is saved. IP Addresses may be considered personal information."|t('sprout'),
        name: 'trackRemoteIp',
        on: settings.trackRemoteIp ? true : false,
        onLabel: "Enable"|t('sprout'),
        warning: config.trackRemoteIp is defined ? configWarning('trackRemoteIp')
    }) }}

    {{ forms.selectField({
        label: "Default Section"|t('sprout'),
        instructions: "The form section that will be selected by default in the sidebar navigation."|t('sprout'),
        name: 'defaultSection',
        options: [
            {
                label: 'Entries'|t('sprout'),
                value: 'entries'
            },
            {
                label: 'Forms'|t('sprout'),
                value: 'forms'
            }
        ],
        value: not settings.enableSaveData ? 'forms' : settings.defaultSection,
        warning: config.enableSaveData is defined ? configWarning('enableSaveData')
    }) }}

</div>

<hr>

{{ forms.lightswitchField({
    label: "Allow Forms to be edited in front-end templates"|t('sprout'),
    instructions: "Enable this setting to allow users to edit existing form entries in front-end templates. Enabling this feature may have some workflow or security considerations as forms allow anonymous submissions."|t('sprout'),
    id: 'enableEditFormEntryViaFrontEnd',
    name: 'enableEditFormEntryViaFrontEnd',
    on: settings.enableEditFormEntryViaFrontEnd,
    onLabel: "Enable"|t('sprout'),
    warning: config.enableEditFormEntryViaFrontEnd is defined ? configWarning('enableEditFormEntryViaFrontEnd')
}) }}