{% requireAdmin %}

{% extends "sprout/_layouts/base" %}
{% import "_includes/forms" as forms %}
{% import "sprout/_includes/sproutcp" as sproutCp %}

{% set title = "Edit Notification"|t('sprout') %}

{% set crumbs = [
    { label: "Notifications", url: url('sprout/notifications') },
] %}

{% set fullPageForm = true %}
{% set saveShortcutRedirect = url('sprout/notifications/settings/edit/{id}') %}

{% if notificationEmail['id'] %}
    {% set notificationEmailId = notificationEmail['id'] %}
{% else %}
    {% set notificationEmailId = '{id}' %}
{% endif %}

{% block actionButton %}

    <div class="buttons">
        <div class="btngroup">
            <input class="btn submit" type="submit"
                value="{{ 'Save'|t('sprout') }}">

            {% if notificationEmail['id'] is defined %}

                {% set dataSaveEditRedirect = cpUrl('sprout/notifications/edit/' ~ notificationEmailId) %}

                <div class="btn submit menubtn"></div>
                <div class="menu">
                    <ul>
                        <li><a class="formsubmit"
                                data-redirect="{{ craft.app.request.url|hash }}"
                                title="{{ 'Save and continue editing'|t('sprout') }}">{{ 'Save and continue editing'|t('sprout') }}
                                <span
                                    class="shortcut">âŒ˜S</span></a>
                        </li>
                    </ul>
                </div>

            {% endif %}
        </div>

        {% if config.getEnableUpgradeMessages() and config.isUpgradable() %}
            {{ sproutCp.upgradeToProButton({
                url: config.getUpgradeUrl(),
                title: config.getUpgradeMessage()
            }) }}
        {% endif %}
    </div>

{% endblock %}

{% set content %}

    <input type="hidden" name="action" value="sprout/notifications/save-notification-email-settings">
    {{ redirectInput('sprout/notifications/edit/' ~ notificationEmailId) }}

    <input type="hidden" name="emailId" value="{{ emailId }}">
    <input type="hidden" name="mailer" value="defaultmailer">

    {% include "_includes/fieldlayoutdesigner" with {
        fieldLayout: notificationEmail.getFieldLayout()
    } only %}

{% endset %}