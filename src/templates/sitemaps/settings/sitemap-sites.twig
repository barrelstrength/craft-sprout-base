{% import "_includes/forms" as forms %}

{% macro configWarning(setting) -%}
    {{ "This is being overridden by the {setting} config setting."|t('sprout-forms-google-recaptcha', {
        setting: setting
    })|raw }}
{%- endmacro %}

{% from _self import configWarning %}

{% if craft.app.isMultiSite %}

    {{ forms.lightswitchField({
        label: "Enable multi-lingual sitemaps"|t('sprout'),
        instructions: "Generate a single, multilingual sitemap.xml file for each Site Group. By default, a sitemap.xml is generated for every Site on your Craft website. If you are managing content in multiple languages, enable this setting to generate a single, multi-lingual sitemap.xml for all Sites in each Site Group. The sitemap.xml be created for the primary domain or the first domain that appears in the list of a specific Site Group."|t,
        name: 'enableMultilingualSitemaps',
        on: settings.enableMultilingualSitemaps,
        id: 'enableMultilingualSitemaps',
        onLabel: "Enable"|t,
        warning: config.enableMultilingualSitemaps is defined ? configWarning('enableMultilingualSitemaps')
    }) }}

    {% set siteRows = [] %}
    {% set siteGroupRows = [] %}
    {% set siteErrors = settings.getErrors('siteSettings') %}
    {% set groupErrors = settings.getErrors('groupSettings') %}

    {% for site in craft.app.sites.getAllSites() %}
        {% set siteSettings = settings.siteSettings[site.id] ?? null %}

        {% set siteRows = siteRows|merge({
            (site.handle): {
                heading: site.name|t('site'),
                enabled: include('_includes/forms/lightswitch', {
                    name: 'siteSettings['~site.id~']',
                    on: siteSettings,
                    value: site.id,
                    small: true
                })
            }
        }) %}
    {% endfor %}

    {% for group in craft.app.sites.getAllGroups() %}
        {% set groupSettings = settings.groupSettings[group.id] ?? null %}

        {% set siteGroupRows = siteGroupRows|merge({
            (group.name): {
                heading: group.name|t('site'),
                enabled: include('_includes/forms/lightswitch', {
                    name: 'groupSettings['~group.id~']',
                    on: groupSettings,
                    value: group.id,
                    small: true
                })
            }
        }) %}
    {% endfor %}

    <div id="siteWrapper" {% if settings.enableMultilingualSitemaps %} class="hidden" {% endif %}>
        {{ forms.editableTableField({
            label: "Enable Sitemaps"|t('sprout'),
            instructions: "Enable each section you wish to include in your XML sitemaps."|t('sprout'),
            id: 'sites',
            name: 'sites',
            cols: {
                heading: {
                    type: 'heading',
                    heading: "Site"|t('sprout'),
                },
                enabled: {
                    type: 'heading',
                    heading: "Enabled"|t('sprout'),
                    class: 'thin'~(not craft.app.getIsMultiSite() ? ' hidden')
                }
            },
            rows: siteRows,
            staticRows: true,
            errors: siteErrors|unique,
            warning: config.sites is defined ? configWarning('sites')
        }) }}
    </div>

    <div id="groupWrapper" {% if not settings.enableMultilingualSitemaps %} class="hidden" {% endif %}>
        {{ forms.editableTableField({
            label: "Enable Sitemaps"|t('sprout'),
            instructions: "Enable each group you wish to include in your XML sitemaps."|t('sprout'),
            id: 'groups',
            name: 'groups',
            cols: {
                heading: {
                    type: 'heading',
                    heading: "Group"|t('sprout'),
                },
                enabled: {
                    type: 'heading',
                    heading: "Enabled"|t('sprout'),
                    class: 'thin'~(not craft.app.getIsMultiSite() ? ' hidden')
                }
            },
            rows: siteGroupRows,
            staticRows: true,
            errors: groupErrors|unique,
            warning: config.groups is defined ? configWarning('groups')
        }) }}
    </div>

{% endif %}

{% do view.registerAssetBundle("barrelstrength\\sproutbase\\web\\assetbundles\\sitemaps\\SitemapsAsset") %}
